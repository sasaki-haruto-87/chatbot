# チャットボット秘書 発表台本

## 📌 導入（約1分）

皆さん、こんにちは。本日は、個人用AI秘書チャットボットについて発表します。

このプロジェクトは、**日常生活の管理をチャットで簡単にする秘書ボット**です。スケジュール管理、食事記録、天気確認などが、自然な日本語で話しかけるだけで実現できます。

---

## 🎯 何を作ろうとしたのか（約1分30秒）

**コンセプト：「手書き手帳をチャットUI化する」**

具体的には以下の機能を目指しました：

### 主要機能
1. **スケジュール管理**
   - 予定の追加・編集・削除・完了マーク
   - 日付・時間・場所・持ち物の記録

2. **食事記録**
   - 朝食・昼食・夕食の記録
   - カロリー・評価・写真のメモ

3. **天気連携**
   - プロフィール地域の天気を自動取得
   - 気温・湿度・風速など詳細情報

4. **プロフィール管理**
   - 名前・年齢・地域をセッション保存
   - ブラウザLocalStorage + サーバー同期

---

## ✅ どこまで完成したのか（約2分30秒）

**現在の進捗：ほぼ機能完成、細部最適化段階**

### 実装完了した部分

#### (1) バックエンド基盤
```
Flask API サーバー（Python）
├─ /api/assistant_call  ... CRUD操作のハブ
├─ /api/assistant_undo  ... 操作の取り消し
├─ /api/chat           ... 会話処理 & コマンド解析
├─ /api/time           ... 現在時刻
└─ /api/weather        ... 天気情報
```

**ポイント**：モード（1=プロフィール、2=スケジュール、5=食事）とタイプ（1=追加、2=編集、3=削除、4=読込）で統一的に処理

#### (2) チャットコマンド全実装
| コマンド | 機能 |
|---------|------|
| 予定 | スケジュール一覧 |
| 次の予定 | 次の予定を表示 |
| 予定完了 | 最新予定を完了に |
| 予定削除 | 最新予定を削除 |
| 外出時 | 今日の残りの予定と持ち物 |
| 食事 | 本日の食事記録一覧 |
| 朝食/昼食/夕食 | 各食事の記録 |
| 食事削除 | 食事の削除 |
| 天候 / 気温 | 天気情報表示 |
| 服装 | 気温から衣類提案 |

#### (3) データベース
- SQLAlchemy ORM + SQLite
- Schedule・Meal・ActionLog テーブル
- 自動タイムスタンプ & UUID管理

#### (4) フロントエンド
- HTML/CSS/vanilla JavaScript
- プロフィール localStorage同期
- 複数行対応チャット表示

---

## 🛠️ Copilot活用での工夫（約2分）

### (1) 段階的な機能実装

**工夫**：「小さな機能 → テスト → 拡張」のサイクル

1. 最初は簡単なAPI設計
2. 各コマンドを1つずつ実装・テスト
3. 同じパターンで他機能も追加

→ **結果**：コードの重複削減、保守性向上

### (2) マルチステップ構想の具体化

**例**：天気機能の実装
```
アイデア: 「気温から自動で服装提案したい」
↓
Copilot提案: 「プロフィール地域から自動取得」
↓
実装: get_current_weather() → 天候、気温、服装コマンドで統合
```

### (3) エラー・バグの系統的解決

**工夫**：Copilotに「なぜうまくいかないのか」を説明させる

- コード生成 → ブラウザテスト → 失敗理由の分析 → 修正
- これを何度も繰り返し、信頼できるコードに

---

## 😤 苦労したこと & 解決方法（約2分30秒）

### 問題1️⃣：チャットコマンドの優先順序バグ

**症状**：「予定完了」入力時に「予定」コマンドが先にマッチして、完了処理されない

**原因**：
```python
# ❌ 悪い例
if '予定' in text:  # 「予定完了」も含まれる
    show_schedule()
elif '予定完了' in text:  # ここに来ない
    complete_schedule()
```

**解決**：**コマンド順序の反転**
```python
# ✅ 良い例
if re.search(r'予定完了|次の予定完了', text):
    complete_schedule()  # 具体的なものを先に
elif re.search(r'予定', text):
    show_schedule()      # 汎用は後に
```

**学び**：正規表現の具体性が大切。Copilotにこの仕組みを説明してもらった。

---

### 問題2️⃣：複数行表示が1行になる

**症状**：スケジュール一覧が改行なしで表示される
```
❌ 9:00 会議 10:00 ランチ 14:00 買い物
```

**原因**：バックエンドで `\n` で区切っても、HTMLでそのまま表示される

**解決**：**3段階対応**

1. **CSS** で `white-space: pre-wrap;` を追加
2. **JavaScript** で `\n` を `<br>` に変換
3. **バックエンド** で改行を明示的に出力

```javascript
// main.js の addMessage()
text.replace(/\n/g, '<br>')
```

**学び**：フロント・バック・CSSが協調して動く重要性を実感。

---

### 問題3️⃣：期限切れスケジュールの表示

**症状**：過去の日付の予定が「🔴 [期限切れ]」マーカー付きで残り続けて、見た目が汚い

**当初案**：赤いマーカーで警告表示
```
🔴 [期限切れ] 9:00 会議
```

**最終案**：**自動削除（Silent Deletion）**

```python
# app.py の schedule_list() で
for s in schedules:
    if s.status == 'active' and s.datetime < now:
        db.session.delete(s)  # さっと消す
        continue
```

**メリット**：
- ユーザーUIがスッキリ
- データベースも整理
- 自動かつ無通知で自然

**Copilot活用**：「期限が過ぎた予定はどう扱うべき？」と相談→このアイデアが提案された

---

### 問題4️⃣：プロフィール同期の複雑さ

**症状**：ブラウザを閉じるとプロフィール情報が消える

**解決**：**2層システム**
- **クライアント側**：localStorage（永続）
- **サーバー側**：Flask session（セッション）
- **同期機構**：毎回のAPI呼び出しでプロフィール送信 → サーバー側で即座に反映

```javascript
// main.js
const profileData = {name, age, region};
localStorage.setItem('profileData', JSON.stringify(profileData));
// APIコール時に同時送信
```

**学び**：分散システムの一貫性を保つには、クライアント・サーバーの責務分離が大切。

---

## 🚀 今後の予定（約1分30秒）

### 近期（1-2週間）
1. **自動削除動作の実装テスト**
   - ブラウザで実際に期限切れ予定が削除されるか確認

2. **エラーハンドリング強化**
   - 不正な日時入力への対応
   - APIエラー時のユーザーフィードバック

### 中期（1ヶ月）
3. **監査ログ機能**（オプション）
   - 削除された予定の履歴を記録
   - 「何が削除されたか」を確認できるように

4. **UI/UX改善**
   - コマンド補完機能
   - よく使うコマンドのショートカット

### 長期（2-3ヶ月）
5. **音声入力**
   - 運転中や手が離せない時の対応

6. **マルチユーザー対応**
   - 家族共有セッション
   - ユーザー間の権限管理

7. **クラウド同期**
   - スマートフォン対応
   - 複数デバイス間の同期

---

## 📊 技術スタック（参考）

| 層 | 技術 |
|----|------|
| バックエンド | Python 3.x, Flask |
| ORM | SQLAlchemy |
| データベース | SQLite |
| フロントエンド | HTML, CSS, vanilla JavaScript |
| API設計 | RESTful（モード+タイプ統一） |

---

## 🎓 今回の学び・反省点

### ✨ 良かった点
- Copilotに「なぜ？」を繰り返し問うて、仕組みを理解した
- 小さな機能から段階的に拡張した
- エラーは「詳細に説明する」ことで共に解決できた

### 📝 改善したい点
- もっと早期にテストケースを作成すべきだった
- 設計段階でAPI仕様をもっと詳しく詰めるべきだった
- ドキュメント（コメント）を同時に作成すべきだった

---

## 締めくくり（約30秒）

このプロジェクトを通じて、**AI Copilotとの対話により、複雑なシステムも段階的に実装できる**ことを体験しました。

単なるコード自動生成ではなく、「設計思想の相談→実装→テスト→改善」という、エンジニアの思考プロセス全体をサポートするツールとして活用できたことが、最大の成果だと考えます。

ご清聴ありがとうございました。ご質問があればお答えします。

---

## 📋 発表時間目安

| セクション | 時間 |
|-----------|------|
| 導入 | 1分 |
| コンセプト | 1分30秒 |
| 進捗状況 | 2分30秒 |
| Copilot活用 | 2分 |
| 苦労とその解決 | 2分30秒 |
| 今後の予定 | 1分30秒 |
| 学びと反省 | 1分 |
| 締めくくり | 30秒 |
| **合計** | **約12分30秒** |

※ 質疑応答用に3-5分の余裕を持たせることをお勧めします
